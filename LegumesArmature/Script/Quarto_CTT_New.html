<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Friederike Wölke">

<title>CTT_plot_New</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Quarto_CTT_New_files/libs/clipboard/clipboard.min.js"></script>
<script src="Quarto_CTT_New_files/libs/quarto-html/quarto.js"></script>
<script src="Quarto_CTT_New_files/libs/quarto-html/popper.min.js"></script>
<script src="Quarto_CTT_New_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Quarto_CTT_New_files/libs/quarto-html/anchor.min.js"></script>
<link href="Quarto_CTT_New_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Quarto_CTT_New_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Quarto_CTT_New_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Quarto_CTT_New_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Quarto_CTT_New_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CTT_plot_New</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Friederike Wölke </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="references-for-this-code" class="level3">
<h3 class="anchored" data-anchor-id="references-for-this-code">References for this code:</h3>
<p>The following code is a mixture of code written by <strong>Liam Revell within the Phytools package</strong>, especially from the source code of the ctt() function (version Oct 2023),</p>
<p>and from the code for Figure 4 in <strong>Stephens et al., (2023):</strong> <a href="https://nph.onlinelibrary.wiley.com/doi/10.1111/nph.18993">Paper</a>; <a href="https://github.com/rubysaltbush/pollination-macroevolution">GitHub Repo</a></p>
<p>Ref [1]</p>
<p>Ref [2]</p>
<p>Ref [3]</p>
</section>
<section id="open-the-required-libraries" class="level1">
<h1>Open the required Libraries</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phytools) <span class="co"># v. ‘1.9.16’ for phylo stuff</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ape</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: maps</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># for data handling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ape':

    where</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(evobiR) <span class="co"># v. ‘1.1’ To reorder data based on tree</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geiger) <span class="co"># v. ‘2.0.11’ for Mk Models</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc) <span class="co"># for time measurements of computations</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># data handling</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'viridis'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:maps':

    unemp</code></pre>
</div>
</div>
</section>
<section id="my-data-legumes-read-back-in-from-rds" class="level1">
<h1>My Data (Legumes) * read back in from RDS</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the data and tree ============================</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>traitData <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../input/Matrix_all_traits.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">read.tree</span>(<span class="st">"../input/Mimo_metachronogram_mmc.tre"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(tree)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>new_tip_names<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../input/replace_tip_labels.csv"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset data by trait </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>armature <span class="ot">&lt;-</span> traitData <span class="sc">%&gt;%</span> <span class="fu">select</span>(Taxon, Armatures) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Taxon) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Armatures)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(.) <span class="co"># 2 species were duplicated (Acacia baileyana and Chidlowiana sanguinea)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Correct tip names in the tree with new labels</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>tree2 <span class="ot">&lt;-</span> tree</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>tree2<span class="sc">$</span>tip.label <span class="ot">&lt;-</span> new_tip_names[[<span class="dv">2</span>]][<span class="fu">match</span>(tree<span class="sc">$</span>tip.label, new_tip_names[[<span class="dv">1</span>]])]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Small subset with 10 species:</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#armature &lt;- armature[1:10,]</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># match data and tree ===================================</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(armature) <span class="ot">&lt;-</span> armature<span class="sc">$</span>Taxon</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>sp_drop <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(tree2<span class="sc">$</span>tip.label, armature<span class="sc">$</span>Taxon)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop these species from the tree, because we need matching data between tree and traits</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>tree3 <span class="ot">&lt;-</span> <span class="fu">drop.tip</span>(tree2, sp_drop)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>tree4 <span class="ot">&lt;-</span> <span class="fu">ladderize</span>(tree3)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>matches <span class="ot">&lt;-</span> <span class="fu">match</span>(armature<span class="sc">$</span>Taxon, tree4<span class="sc">$</span>tip.label, <span class="at">nomatch =</span> <span class="dv">0</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>armature2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(armature, matches <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(tree4<span class="sc">$</span>tip.label, armature2<span class="sc">$</span>Taxon) <span class="co"># 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(armature2<span class="sc">$</span>Taxon, tree4<span class="sc">$</span>tip.label) <span class="co"># 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> tree4</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make data for Mk models for Armature</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>armature2[armature2<span class="sc">==</span><span class="st">"0"</span>] <span class="ot">&lt;-</span> <span class="st">"no_armature"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>armature2[armature2<span class="sc">==</span><span class="st">"1"</span>] <span class="ot">&lt;-</span> <span class="st">"armature"</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>trait <span class="ot">&lt;-</span> <span class="fu">unique</span>(armature2)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>trait <span class="ot">&lt;-</span> <span class="fu">ReorderData</span>(tree, trait, <span class="at">taxa.names =</span> <span class="st">"row names"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>trait<span class="sc">$</span>Armatures <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trait<span class="sc">$</span>Armatures)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>trait<span class="sc">$</span>Taxon <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean environment to free memory:</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tree2, tree3, tree4, traitData, new_tip_names, armature, matches, sp_drop)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Mk models ============================</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the rates of transitioning between ancestral states given a hypothesis (either equal rates(ER), or different rates(ARD))</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># computing time = 11.58s</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  equal <span class="ot">&lt;-</span> <span class="fu">fitDiscrete</span>(tree, trait, <span class="at">model =</span> <span class="st">"ER"</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>6.08 sec elapsed</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># computing time = 42.85s</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  ard <span class="ot">&lt;-</span> <span class="fu">fitDiscrete</span>(tree, trait, <span class="at">model =</span> <span class="st">"ARD"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>16.25 sec elapsed</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AIC weights</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>aic.discrete <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(equal<span class="sc">$</span>opt<span class="sc">$</span>aic, ard<span class="sc">$</span>opt<span class="sc">$</span>aic), <span class="fu">c</span>(<span class="st">"equal"</span>, <span class="st">"different"</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">aicw</span>(aic.discrete)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>weights <span class="co"># ARD model performs better for armature/no armature</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               fit    delta            w
equal     958.2419 36.04662 1.487907e-08
different 922.1952  0.00000 1.000000e+00</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we need a slightly different format for Simmap:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>trait2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trait<span class="sc">$</span>Armatures)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(trait2) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(trait)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For 100 simulation (nsim=100) --&gt; computing time = 725.28s &amp;&amp; 373.7 sec elapsed</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  mtrees <span class="ot">&lt;-</span> <span class="fu">make.simmap</span>(tree, trait2, <span class="at">model =</span> <span class="st">"ARD"</span>, <span class="at">nsim =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>make.simmap is sampling character histories conditioned on
the transition matrix

Q =
                armature  no_armature
armature    -0.028557812  0.028557812
no_armature  0.006412091 -0.006412091
(estimated using likelihood);
and (mean) root node prior probabilities
pi =
   armature no_armature 
        0.5         0.5 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Done.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>158.92 sec elapsed</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mtrees, <span class="st">"../output/RDS/mtrees_multiSimmap.rds"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.35s</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  pd_mtrees <span class="ot">&lt;-</span> <span class="fu">describe.simmap</span>(mtrees, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2.7 sec elapsed</code></pre>
</div>
</div>
</section>
<section id="my-adaptation-of-ctt-function-in-loop-save-to-list" class="level1">
<h1>My adaptation of ctt function (in loop, save to list)</h1>
<p>Reference: <a href="https://github.com/liamrevell/phytools/blob/master/R/ctt.R">ctt.R</a> (Phytools package)</p>
<pre><code>&gt; packageVersion("phytools") [1] ‘1.9.16’</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>( <span class="st">"loop"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>mtrees <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../output/RDS/mtrees_multiSimmap.rds"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Required function ========================================================================== #</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>getChanges<span class="ot">&lt;-</span><span class="cf">function</span>(tree){</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  states<span class="ot">&lt;-</span><span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">getStates</span>(tree)))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  nc<span class="ot">&lt;-</span><span class="fu">sapply</span>(tree<span class="sc">$</span>maps,length)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">&lt;-</span><span class="fu">which</span>(nc<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  nc<span class="ot">&lt;-</span>nc[b]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  xx<span class="ot">&lt;-</span><span class="fu">vector</span>()</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  H<span class="ot">&lt;-</span><span class="fu">nodeHeights</span>(tree)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(b)){</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nc[i]){</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>      ss<span class="ot">&lt;-</span><span class="fu">names</span>(tree<span class="sc">$</span>maps[[b[i]]])[j<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>      x<span class="ot">&lt;-</span><span class="fu">rep</span>(H[b[i],<span class="dv">1</span>]<span class="sc">+</span><span class="fu">cumsum</span>(tree<span class="sc">$</span>maps[[b[i]]])[j],<span class="dv">2</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>      xx<span class="ot">&lt;-</span><span class="fu">c</span>(xx,<span class="fu">setNames</span>(x[<span class="dv">1</span>],</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(<span class="fu">names</span>(tree<span class="sc">$</span>maps[[b[i]]])[j<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)],</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">collapse=</span><span class="st">"-&gt;"</span>)))</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  xx</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================================= #</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to find the segment ID for a given time value:</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================================= #</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>find_segment_id <span class="ot">&lt;-</span> <span class="cf">function</span>(time) {</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  segment_indices <span class="ot">&lt;-</span> <span class="fu">cut</span>(time, <span class="at">breaks =</span> segs_df[, <span class="dv">2</span>], <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(segs_df<span class="sc">$</span>segsID[segment_indices])</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="do">## ============================================================================================= #</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Working the multiSiammp</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get all changes from all simulations so that we can loop through them:</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>  changes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mtrees, getChanges) </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform the original changes list of matrices from sapply() for all simulations to dataframe </span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add trans_no to each transition based on grouping by transition </span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (i.e, there are two trans_no = 1, one for each transition type)</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>  i_changes_list <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(changes)) {</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    i_changes <span class="ot">&lt;-</span> changes[[i]] <span class="co"># for each simulation from multiSimmap</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract transition types and times and assign ID column for simmap simulation</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>    i_changes_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">transition =</span> <span class="fu">names</span>(i_changes), <span class="at">time =</span> i_changes, <span class="at">N_sim =</span> i)</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    i_changes_df<span class="sc">$</span>transition <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(i_changes_df<span class="sc">$</span>transition)</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add trans_no to each transition from a group (transition type)</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    i_changes_df <span class="ot">&lt;-</span> i_changes_df <span class="sc">%&gt;%</span>  <span class="fu">arrange</span>(time) <span class="sc">%&gt;%</span></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(transition) <span class="sc">%&gt;%</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">trans_no =</span> <span class="fu">row_number</span>())</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>    i_changes_list[[i]] <span class="ot">&lt;-</span> i_changes_df</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final Table without edge.lengths:</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>  changes_table <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(i_changes_list, <span class="at">fill=</span>T)</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>  changes_table_wo_edge <span class="ot">&lt;-</span> changes_table</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a><span class="co"># ====================================================================================================== #</span></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: Loop over each simulation and extract </span></span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a><span class="co"># - breaks for segments</span></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a><span class="co"># - edge.lengths</span></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a><span class="co"># - rates for each character state transition</span></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ====================================================================================================== #</span></span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>object_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>rates_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a><span class="co"># First Level of the loop  </span></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (Nsimulation <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){ </span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ====================================================================================================== #</span></span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Setting global variables for the Analysis</span></span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ====================================================================================================== #</span></span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set the number of time-segments for which everything will be calculated:</span></span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="dv">20</span>    </span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reduce to one tree to extract parameters from each simulation separately:</span></span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>  tree <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(mtrees[[Nsimulation]])</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract time since root</span></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nodeHeights</span>(tree))</span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the time segments based on time since the origin and the time segments that were set by the user</span></span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>  segs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,h<span class="sc">-</span>h<span class="sc">/</span>b,h<span class="sc">/</span>b),</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>              <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span>b<span class="sc">*</span>h,h,h<span class="sc">/</span>b))</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ====================================================================================================== #</span></span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transitions &amp; Timing  (getChanges)</span></span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ====================================================================================================== #</span></span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Working changes from each simmap simulation separately:</span></span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------- #</span></span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Changes per Segments:</span></span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through all changes &amp; Calculate average number of changes per time interval (segs; set with "b")</span></span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>  nchanges<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,b)</span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(changes)) { <span class="co"># loop through all simulations from simmap  </span></span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through all individual changes from one simmap simulation and calculate relative changes per time segment</span></span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a><span class="co"># nchanges = collects the relative number of changes (of all changes) per segment</span></span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(changes[[i]])) { </span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>      ind<span class="ot">&lt;-</span><span class="fu">which</span>((changes[[i]][j]<span class="sc">&gt;</span>segs[,<span class="dv">1</span>])<span class="sc">+</span> </span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>                   (changes[[i]][j]<span class="sc">&lt;=</span>segs[,<span class="dv">2</span>])<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a>      nchanges[ind]<span class="ot">&lt;-</span>nchanges[ind]<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fu">length</span>(changes)</span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>      } <span class="co"># closing of 2nd level</span></span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># closing of 1st level</span></span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(i,j)  </span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Working changes from each simmap simulation separately:</span></span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------- #</span></span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edge Lengths per Segments:</span></span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edge.Lengths = Number of species in the phylogeny per time slot (increases naturally with time)</span></span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Note: has to be accounted for when showing transition rates</span></span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we calculate edge lengths for each segement separatly:</span></span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------------------------------------- #</span></span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute Lineages-Through-Time with ltt() function from the phytools package to extract edge.lengths from</span></span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>  LTT <span class="ot">&lt;-</span> <span class="fu">ltt</span>(tree,<span class="at">plot=</span><span class="cn">FALSE</span>)</span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform LTT data so that we can use it:</span></span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>  LTT <span class="ot">&lt;-</span> <span class="fu">cbind</span>(LTT<span class="sc">$</span>ltt[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(LTT<span class="sc">$</span>ltt)<span class="sc">-</span><span class="dv">1</span>)],                <span class="co"># Number of species at each node minus the root</span></span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>               LTT<span class="sc">$</span>times[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(LTT<span class="sc">$</span>ltt)<span class="sc">-</span><span class="dv">1</span>)],              <span class="co"># "start" time for each node minus the root</span></span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>               LTT<span class="sc">$</span>times[<span class="dv">3</span><span class="sc">:</span><span class="fu">length</span>(LTT<span class="sc">$</span>ltt)])                  <span class="co"># "end" time for each node minus the root</span></span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------------------------------------- #</span></span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Now we loop through all segments to extract matching edge.lengths =================================== #</span></span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set count variable:</span></span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a>    ii<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-173"><a href="#cb31-173" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty vector to store edge lengths</span></span>
<span id="cb31-174"><a href="#cb31-174" aria-hidden="true" tabindex="-1"></a>    edge.length <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(segs))</span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2nd level loop: </span></span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (for one tree because LTT is calculated for one tree)</span></span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i_segs <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(segs)) {</span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Find the indices of LTT segments that overlap with the current segs segment</span></span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a>     overlap_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(LTT[, <span class="dv">2</span>] <span class="sc">&lt;=</span> segs[i_segs, <span class="dv">2</span>] <span class="sc">&amp;</span> LTT[, <span class="dv">3</span>] <span class="sc">&gt;=</span> segs[i_segs, <span class="dv">1</span>])</span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Calculate edge length for the current segs segment using vectorized operations</span></span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a>     <span class="co"># 3rd level loop: </span></span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (ii <span class="cf">in</span> overlap_indices) {</span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a>       <span class="co"># edge.length should contain the edge lengths for all segments:  </span></span>
<span id="cb31-191"><a href="#cb31-191" aria-hidden="true" tabindex="-1"></a>       edge.length[i_segs] <span class="ot">&lt;-</span> edge.length[i_segs] <span class="sc">+</span>        </span>
<span id="cb31-192"><a href="#cb31-192" aria-hidden="true" tabindex="-1"></a>         LTT[ii, <span class="dv">1</span>] <span class="sc">*</span> <span class="co"># counts number of lineages between time intervals</span></span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a>         (<span class="fu">min</span>(segs[i_segs, <span class="dv">2</span>], LTT[ii, <span class="dv">3</span>]) <span class="sc">-</span> <span class="co"># end time interval</span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a>            <span class="fu">max</span>(segs[i_segs, <span class="dv">1</span>], LTT[ii, <span class="dv">2</span>]))  <span class="co"># start time interval</span></span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a>       } <span class="co"># 3rd level closing</span></span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a>   } <span class="co"># 2nd level closing</span></span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a>    edge.length_backup <span class="ot">&lt;-</span> edge.length</span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a>    edge.length <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span>, edge.length)</span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># edge.length should contain the edge lengths for all segments in a given simulation</span></span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adding segsID coulmn to edge lengths:</span></span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a>    edge.length_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">edge.length =</span> edge.length, <span class="at">segsID =</span> <span class="fu">seq</span>(<span class="dv">1</span>,b<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a>    <span class="do">#########################################################################################################</span></span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># WIP: </span></span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a>    <span class="do">#########################################################################################################</span></span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ================================================================= #</span></span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Working the multiSimmap:</span></span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------- #</span></span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edge Lengths at each transition event</span></span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ================================================================= #</span></span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Adapted code from the segments by me</span></span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we need the table for all simmaps: changes_table so that we can loop through it</span></span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set count variable:</span></span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a>    ii<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty vector to store edge lengths</span></span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a>    edge.length_transitions <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(changes_table))</span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a>  edge.lengths_all <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a>    changes_times <span class="ot">&lt;-</span> changes_table<span class="sc">$</span>time</span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2nd level loop: </span></span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (for one tree because LTT is calculated for one tree)</span></span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i_changes <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(changes_table)) {</span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Find the indices of LTT segments that overlap with the current segs segment</span></span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a>     <span class="co"># "which start times of the Lineages are smaller or equal to the time the change happened and which end times of the lineages are larger or equal to the time the change happend."</span></span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a>     <span class="co"># --&gt; this gives the node numbers that were there when the transition happend</span></span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a>     overlap_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(LTT[, <span class="dv">2</span>] <span class="sc">&lt;=</span> changes_times[i_changes] <span class="sc">&amp;</span> LTT[, <span class="dv">3</span>] <span class="sc">&gt;=</span> changes_times[i_changes])</span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Calculate edge length for the current segs segment using vectorized operations</span></span>
<span id="cb31-247"><a href="#cb31-247" aria-hidden="true" tabindex="-1"></a>     <span class="co"># 3rd level loop: </span></span>
<span id="cb31-248"><a href="#cb31-248" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (ii <span class="cf">in</span> overlap_indices) { <span class="co"># ii = number of lineages when a transition occurred</span></span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a>       <span class="co"># edge.length should contain the edge lengths for all segments:  </span></span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a>       edge.length_transitions[i_changes] <span class="ot">&lt;-</span> edge.length_transitions[i_changes] <span class="sc">+</span>        </span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a>         LTT[ii, <span class="dv">1</span>] </span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a>       edge.length_transitions2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> changes_times[i_changes], <span class="at">edge.length =</span> edge.length_transitions[i_changes])</span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-258"><a href="#cb31-258" aria-hidden="true" tabindex="-1"></a>       edge.lengths_all[[i_changes]] <span class="ot">&lt;-</span> edge.length_transitions2</span>
<span id="cb31-259"><a href="#cb31-259" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb31-260"><a href="#cb31-260" aria-hidden="true" tabindex="-1"></a>       } <span class="co"># 3rd level closing</span></span>
<span id="cb31-261"><a href="#cb31-261" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-262"><a href="#cb31-262" aria-hidden="true" tabindex="-1"></a>   } <span class="co"># 2nd level closing</span></span>
<span id="cb31-263"><a href="#cb31-263" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-264"><a href="#cb31-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-265"><a href="#cb31-265" aria-hidden="true" tabindex="-1"></a>  edge.lengths_all_df <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(edge.lengths_all)</span>
<span id="cb31-266"><a href="#cb31-266" aria-hidden="true" tabindex="-1"></a>  changes_table_w_edge <span class="ot">&lt;-</span> <span class="fu">merge</span>(changes_table_wo_edge, edge.lengths_all_df, <span class="at">by =</span> <span class="st">"time"</span>)</span>
<span id="cb31-267"><a href="#cb31-267" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write to file (once is enough)</span></span>
<span id="cb31-268"><a href="#cb31-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(changes_table_w_edge, <span class="st">"../output/CSV/changes_table_w_edgelengths.csv"</span>)</span>
<span id="cb31-269"><a href="#cb31-269" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-270"><a href="#cb31-270" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################################################################################</span></span>
<span id="cb31-271"><a href="#cb31-271" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="re">END</span><span class="co"> WIP </span></span>
<span id="cb31-272"><a href="#cb31-272" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################################################################################</span></span>
<span id="cb31-273"><a href="#cb31-273" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-274"><a href="#cb31-274" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb31-275"><a href="#cb31-275" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================================= #</span></span>
<span id="cb31-276"><a href="#cb31-276" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with transitions, times, edge.lengths, segment IDs.</span></span>
<span id="cb31-277"><a href="#cb31-277" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================================= #</span></span>
<span id="cb31-278"><a href="#cb31-278" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-279"><a href="#cb31-279" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We are here = first level loop: along simulations</span></span>
<span id="cb31-280"><a href="#cb31-280" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-281"><a href="#cb31-281" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Again extract changes for each simulation separately:</span></span>
<span id="cb31-282"><a href="#cb31-282" aria-hidden="true" tabindex="-1"></a>      current_simulation <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(changes[[Nsimulation]], </span>
<span id="cb31-283"><a href="#cb31-283" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">row.names =</span> <span class="fu">names</span>(changes[[Nsimulation]]))</span>
<span id="cb31-284"><a href="#cb31-284" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(current_simulation) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>)</span>
<span id="cb31-285"><a href="#cb31-285" aria-hidden="true" tabindex="-1"></a>      current_simulation<span class="sc">$</span>transition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(current_simulation)</span>
<span id="cb31-286"><a href="#cb31-286" aria-hidden="true" tabindex="-1"></a>        current_simulation<span class="sc">$</span>N_sim <span class="ot">&lt;-</span> Nsimulation</span>
<span id="cb31-287"><a href="#cb31-287" aria-hidden="true" tabindex="-1"></a>        current_simulation <span class="ot">&lt;-</span> current_simulation <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(time)</span>
<span id="cb31-288"><a href="#cb31-288" aria-hidden="true" tabindex="-1"></a>        current_simulation<span class="sc">$</span>IDtransition <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(current_simulation))</span>
<span id="cb31-289"><a href="#cb31-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-290"><a href="#cb31-290" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-291"><a href="#cb31-291" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ============================================================================================= #</span></span>
<span id="cb31-292"><a href="#cb31-292" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Working the segments: </span></span>
<span id="cb31-293"><a href="#cb31-293" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ============================================================================================= #</span></span>
<span id="cb31-294"><a href="#cb31-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-295"><a href="#cb31-295" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-296"><a href="#cb31-296" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a vector of segment IDs</span></span>
<span id="cb31-297"><a href="#cb31-297" aria-hidden="true" tabindex="-1"></a>        segs_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(segs)</span>
<span id="cb31-298"><a href="#cb31-298" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">V1 =</span> <span class="dv">0</span>, <span class="at">V2 =</span> <span class="dv">0</span>)</span>
<span id="cb31-299"><a href="#cb31-299" aria-hidden="true" tabindex="-1"></a>        segs_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(new_row, segs_df)</span>
<span id="cb31-300"><a href="#cb31-300" aria-hidden="true" tabindex="-1"></a>        segs_df<span class="sc">$</span>segsID <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,b<span class="sc">+</span><span class="dv">1</span>) <span class="co"># now we can calculate the breaks from it</span></span>
<span id="cb31-301"><a href="#cb31-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-302"><a href="#cb31-302" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use the apply function to find the segment ID for each row in current_simulation</span></span>
<span id="cb31-303"><a href="#cb31-303" aria-hidden="true" tabindex="-1"></a>        current_simulation<span class="sc">$</span>segsID <span class="ot">&lt;-</span> <span class="fu">apply</span>(current_simulation, <span class="dv">1</span>, <span class="cf">function</span>(row) {</span>
<span id="cb31-304"><a href="#cb31-304" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-305"><a href="#cb31-305" aria-hidden="true" tabindex="-1"></a>          time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(row[<span class="st">"time"</span>])</span>
<span id="cb31-306"><a href="#cb31-306" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(<span class="fu">find_segment_id</span>(time))</span>
<span id="cb31-307"><a href="#cb31-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-308"><a href="#cb31-308" aria-hidden="true" tabindex="-1"></a>          }) <span class="co"># closing loop from within the apply-function (2nd level loop closing)</span></span>
<span id="cb31-309"><a href="#cb31-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-310"><a href="#cb31-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-311"><a href="#cb31-311" aria-hidden="true" tabindex="-1"></a>        <span class="co"># assign edge.length based on segment ID</span></span>
<span id="cb31-312"><a href="#cb31-312" aria-hidden="true" tabindex="-1"></a>        current_simulation <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">merge</span>(current_simulation, edge.length_df, <span class="at">by=</span><span class="st">"segsID"</span>, <span class="at">all =</span> T))</span>
<span id="cb31-313"><a href="#cb31-313" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(segs_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"segs_start"</span>, <span class="st">"segs_end"</span>, <span class="st">"segsID"</span>)</span>
<span id="cb31-314"><a href="#cb31-314" aria-hidden="true" tabindex="-1"></a>      current_simulation <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">merge</span>(current_simulation, segs_df, <span class="at">by =</span> <span class="st">"segsID"</span>, <span class="at">all =</span> T))</span>
<span id="cb31-315"><a href="#cb31-315" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-316"><a href="#cb31-316" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate rate for each simulation:</span></span>
<span id="cb31-317"><a href="#cb31-317" aria-hidden="true" tabindex="-1"></a>        current_simulation_rates <span class="ot">&lt;-</span> current_simulation <span class="sc">%&gt;%</span> </span>
<span id="cb31-318"><a href="#cb31-318" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(segsID, N_sim, transition) <span class="sc">%&gt;%</span> </span>
<span id="cb31-319"><a href="#cb31-319" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Nchanges =</span> <span class="fu">length</span>(<span class="sc">!</span><span class="fu">is.na</span>(IDtransition))) <span class="sc">%&gt;%</span> </span>
<span id="cb31-320"><a href="#cb31-320" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">rate =</span> Nchanges <span class="sc">/</span> edge.length)</span>
<span id="cb31-321"><a href="#cb31-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-322"><a href="#cb31-322" aria-hidden="true" tabindex="-1"></a>     rates_list[[Nsimulation]] <span class="ot">&lt;-</span> current_simulation_rates</span>
<span id="cb31-323"><a href="#cb31-323" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-324"><a href="#cb31-324" aria-hidden="true" tabindex="-1"></a>     object <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">segments=</span>segs, </span>
<span id="cb31-325"><a href="#cb31-325" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nchanges=</span>nchanges, </span>
<span id="cb31-326"><a href="#cb31-326" aria-hidden="true" tabindex="-1"></a>                   <span class="at">edge.length=</span>edge.length[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb31-327"><a href="#cb31-327" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tree=</span>tree)</span>
<span id="cb31-328"><a href="#cb31-328" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb31-329"><a href="#cb31-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">class</span>(object)<span class="ot">&lt;-</span><span class="st">"ctt"</span></span>
<span id="cb31-330"><a href="#cb31-330" aria-hidden="true" tabindex="-1"></a>    object_list[[Nsimulation]] <span class="ot">&lt;-</span> object </span>
<span id="cb31-331"><a href="#cb31-331" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-332"><a href="#cb31-332" aria-hidden="true" tabindex="-1"></a>} <span class="co"># 1st level closing</span></span>
<span id="cb31-333"><a href="#cb31-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-334"><a href="#cb31-334" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()  <span class="co"># 1218.6 sec elapsed = 20.3 min</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>loop: 1655.72 sec elapsed</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(object_list) <span class="ot">&lt;-</span><span class="st">"multiCtt"</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">"~/GitHub/Evo-Legumes-Herbivory/LegumesArmature/output/RData/rates_ws.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="post-processing-of-data" class="level1">
<h1>Post-processing of data</h1>
<p><strong><em>To do:</em></strong></p>
<p>Currently, if there was no transition of a specific type at a specific time, there is no indication of a rate. However, the rate should be zero if there was no transition. In the following code I try to replicate each time segment twice and add transitions for both types with rates == 0.<br>
I’m not done with this yet.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../output/RData/rates_ws.RData"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>rates_df <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(rates_list)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rates_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     segsID           time          transition            N_sim       
 Min.   : 1.00   Min.   : 0.2593   Length:14876       Min.   :  1.00  
 1st Qu.:16.00   1st Qu.:32.4640   Class :character   1st Qu.: 26.00  
 Median :19.00   Median :37.5279   Mode  :character   Median : 50.00  
 Mean   :16.94   Mean   :34.5870                      Mean   : 50.56  
 3rd Qu.:20.00   3rd Qu.:40.0881                      3rd Qu.: 75.00  
 Max.   :21.00   Max.   :41.1477                      Max.   :100.00  
                 NA's   :490                          NA's   :490     
  IDtransition     edge.length       segs_start       segs_end    
 Min.   :  1.00   Min.   :   1.0   Min.   : 0.00   Min.   : 0.00  
 1st Qu.: 36.00   1st Qu.: 580.6   1st Qu.:28.80   1st Qu.:30.86  
 Median : 72.00   Median :1603.7   Median :34.98   Median :37.03  
 Mean   : 72.63   Mean   :1378.6   Mean   :30.76   Mean   :32.80  
 3rd Qu.:108.00   3rd Qu.:2327.5   3rd Qu.:37.03   3rd Qu.:39.09  
 Max.   :162.00   Max.   :3194.7   Max.   :39.09   Max.   :41.15  
 NA's   :490                                                      
    Nchanges         rate         
 Min.   : 1.0   Min.   :0.000313  
 1st Qu.: 5.0   1st Qu.:0.008106  
 Median :12.0   Median :0.010741  
 Mean   :14.7   Mean   :0.021019  
 3rd Qu.:25.0   3rd Qu.:0.013319  
 Max.   :45.0   Max.   :2.000000  
                                  </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your data manipulation code</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>rates_df <span class="ot">&lt;-</span> rates_df <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(N_sim, segsID, transition) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(transition), <span class="dv">0</span>, rate),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Nchanges =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(transition), <span class="dv">0</span>, Nchanges),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">segs_mean =</span> (segs_end<span class="sc">+</span> segs_start)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="co"># Adjust the threshold (1e-6) as needed</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_time =</span> <span class="fu">ifelse</span>(Nchanges <span class="sc">==</span> <span class="dv">1</span>, time, <span class="fu">mean</span>(time))) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(avg_time), segs_mean, avg_time)) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(segsID) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs in Transition types to set the rates to 0 where no transition occurred:</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>rates_df_copy <span class="ot">&lt;-</span> rates_df</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace "NA" with the first transition type</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>rates_df_copy<span class="sc">$</span>transition[<span class="fu">is.na</span>(rates_df_copy<span class="sc">$</span>transition)] <span class="ot">&lt;-</span> <span class="fu">unique</span>(rates_df_copy<span class="sc">$</span>transition)[[<span class="dv">2</span>]]</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a second copy of the data frame with "NA" transitions</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>rates_df_copy2 <span class="ot">&lt;-</span> rates_df</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace "NA" with the second transition type</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>rates_df_copy2<span class="sc">$</span>transition[<span class="fu">is.na</span>(rates_df_copy2<span class="sc">$</span>transition)] <span class="ot">&lt;-</span> <span class="fu">unique</span>(rates_df_copy2<span class="sc">$</span>transition)[[<span class="dv">3</span>]]</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two copies to get the final data frame with replicates</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(rates_df_copy, rates_df_copy2)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="do">########## ====================================================================================== ####</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the transition type for which you want to ensure rates</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>specific_transition_type <span class="ot">&lt;-</span> <span class="fu">unique</span>(rates_df_copy<span class="sc">$</span>transition)[[<span class="dv">2</span>]]</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a data frame with all possible combinations of segsID and the specific transition type</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>all_combinations <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">segsID =</span> <span class="fu">unique</span>(final_df<span class="sc">$</span>segsID),</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">transition =</span> specific_transition_type</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join the generated data frame with the original data frame</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>final_df1 <span class="ot">&lt;-</span> all_combinations <span class="sc">%&gt;%</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(final_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"segsID"</span>, <span class="st">"transition"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(rate), <span class="dv">0</span>, rate))<span class="co"># Generate a data frame with all possible combinations of segsID and the specific transition type</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>all_combinations <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">segsID =</span> <span class="fu">unique</span>(final_df1<span class="sc">$</span>segsID),</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">transition =</span> specific_transition_type</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join the generated data frame with the original data frame</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>final_df1 <span class="ot">&lt;-</span> all_combinations <span class="sc">%&gt;%</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(final_df1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"segsID"</span>, <span class="st">"transition"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(rate), <span class="dv">0</span>, rate))</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="do">########## ====================================================================================== ####</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the transition type for which you want to ensure rates</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>specific_transition_type <span class="ot">&lt;-</span> <span class="fu">unique</span>(rates_df_copy<span class="sc">$</span>transition)[[<span class="dv">1</span>]]</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a data frame with all possible combinations of segsID and the specific transition type</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>all_combinations2 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">segsID =</span> <span class="fu">unique</span>(final_df<span class="sc">$</span>segsID),</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">transition =</span> specific_transition_type</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join the generated data frame with the original data frame</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>final_df2 <span class="ot">&lt;-</span> all_combinations2 <span class="sc">%&gt;%</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(final_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"segsID"</span>, <span class="st">"transition"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(rate), <span class="dv">0</span>, rate))<span class="co"># Generate a data frame with all possible combinations of segsID and the specific transition type</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>all_combinations2 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">segsID =</span> <span class="fu">unique</span>(final_df2<span class="sc">$</span>segsID),</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">transition =</span> specific_transition_type</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join the generated data frame with the original data frame</span></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>final_df2 <span class="ot">&lt;-</span> all_combinations2 <span class="sc">%&gt;%</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(final_df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"segsID"</span>, <span class="st">"transition"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(rate), <span class="dv">0</span>, rate))</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a><span class="do">########## ====================================================================================== ####</span></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the data frame if needed</span></span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> final_df <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(segsID)  <span class="co"># You can specify the sorting order</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Now final_df contains rows with "NA" in the "transition" column replaced by two different transition types.</span></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Your ggplot code</span></span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(final_df, <span class="fu">aes</span>(<span class="at">y =</span> rate, <span class="at">x =</span> segs_end, <span class="at">col =</span> <span class="fu">factor</span>(transition), <span class="at">group =</span> <span class="fu">factor</span>(transition))) <span class="sc">+</span></span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point() +</span></span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.015</span>)<span class="sc">+</span></span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 270 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(final_df, <span class="fu">aes</span>(<span class="at">y =</span> rate, <span class="at">x =</span> segs_end, <span class="at">fill =</span> <span class="fu">factor</span>(transition))) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.015</span>)<span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete=</span>T, <span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4236 rows containing missing values (`geom_col()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="plot.ctt-function" class="level1">
<h1>– Plot.ctt function –</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>plot.ctt<span class="ot">&lt;-</span><span class="cf">function</span>(x,...){</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  h<span class="ot">&lt;-</span><span class="fu">max</span>(<span class="fu">nodeHeights</span>(x<span class="sc">$</span>tree))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  args<span class="ot">&lt;-</span><span class="fu">list</span>(...)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(args<span class="sc">$</span>type)){ </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    type<span class="ot">&lt;-</span>args<span class="sc">$</span>type</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>type<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> type<span class="ot">&lt;-</span><span class="st">"rate"</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(args<span class="sc">$</span>show.tree)){</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    show.tree<span class="ot">&lt;-</span>args<span class="sc">$</span>show.tree</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>show.tree<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> show.tree<span class="ot">&lt;-</span><span class="cn">FALSE</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(args<span class="sc">$</span>add)){ </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    add<span class="ot">&lt;-</span>args<span class="sc">$</span>add</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>add<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> add<span class="ot">&lt;-</span><span class="cn">FALSE</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>ylim)) </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>ylim<span class="ot">&lt;-</span><span class="cf">if</span>(type<span class="sc">==</span><span class="st">"number"</span>)<span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(x<span class="sc">$</span>nchanges)) <span class="cf">else</span> </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(x<span class="sc">$</span>nchanges<span class="sc">/</span>x<span class="sc">$</span>edge.length))</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>xlim))</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>xlim<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">max</span>(x<span class="sc">$</span>segments),<span class="fu">min</span>(x<span class="sc">$</span>segments))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>lwd)) args<span class="sc">$</span>lwd<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>xlab)) args<span class="sc">$</span>xlab<span class="ot">&lt;-</span><span class="st">"time since the present"</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>ylab)) </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>ylab<span class="ot">&lt;-</span><span class="cf">if</span>(type<span class="sc">==</span><span class="st">"number"</span>) <span class="st">"mean number of changes"</span> <span class="cf">else</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"mean number of changes / total edge length"</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>type<span class="ot">&lt;-</span><span class="st">"l"</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>x<span class="ot">&lt;-</span>h<span class="sc">-</span><span class="fu">as.vector</span>(<span class="fu">t</span>(x<span class="sc">$</span>segments))</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>y<span class="ot">&lt;-</span><span class="cf">if</span>(type<span class="sc">==</span><span class="st">"number"</span>) <span class="fu">rbind</span>(x<span class="sc">$</span>nchanges,x<span class="sc">$</span>nchanges) <span class="cf">else</span> </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(x<span class="sc">$</span>nchanges<span class="sc">/</span>x<span class="sc">$</span>edge.length,x<span class="sc">$</span>nchanges<span class="sc">/</span>x<span class="sc">$</span>edge.length)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>add) <span class="fu">do.call</span>(plot,args)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">do.call</span>(lines,args)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(show.tree) <span class="fu">plotTree</span>(x<span class="sc">$</span>tree,<span class="at">add=</span><span class="cn">TRUE</span>,<span class="at">ftype=</span><span class="st">"off"</span>,<span class="at">lwd=</span><span class="dv">1</span>,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color=</span><span class="fu">make.transparent</span>(<span class="st">"blue"</span>,<span class="fl">0.1</span>),<span class="at">mar=</span><span class="fu">par</span>()<span class="sc">$</span>mar,</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>                         <span class="at">direction=</span><span class="st">"leftwards"</span>,<span class="at">xlim=</span>args<span class="sc">$</span>xlim)</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ctt</span>(object, <span class="at">type=</span><span class="st">"rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(object<span class="sc">$</span>nchanges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(object<span class="sc">$</span>edge.length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
</section>
<section id="plot-the-rate" class="level1">
<h1>Plot the rate</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################################################################################</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>rates_df <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time , <span class="at">y =</span> rate, <span class="at">col =</span> <span class="fu">as.factor</span>(transition))) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point()+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_smooth(method = "lm", formula = rate~time)+</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete=</span>T, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 15 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># changes_table_w_edge %&gt;% </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = time , y = rate, fill = as.factor(transition))) +</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar()+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis(discrete=T, alpha = 0.6)+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_light()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section" class="level1">
<h1></h1>
</section>
<section id="my-adaptation-of-pollination-study-code" class="level1">
<h1>My adaptation of Pollination study code</h1>
<p>Based on: Ref[0]: <a href="https://github.com/rubysaltbush/pollination-macroevolution/">Pollination-Macroevolution Study</a>, which was based on Ref[1]: Liam Revell’s <a href="http://blog.phytools.org/2015/08/getting-timing-of-trait-changes-from.html">Blog Post</a>.</p>
<p>Transition_times function comes from script Ref[2]: <a href="https://github.com/rubysaltbush/pollination-macroevolution/blob/main/scripts/functions/transition_times.R">transition_times.R</a></p>
<p>Code below function comes from script Ref[3]: <a href="https://github.com/rubysaltbush/pollination-macroevolution/blob/main/scripts/analysis/simmap.R">Simmap.R</a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Ref[1], Ref[0] -&gt; Ref[2]</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>transition_times <span class="ot">&lt;-</span> <span class="cf">function</span>(simmap){</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># below adapted from Liam Revells' phytools blog </span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># http://blog.phytools.org/2015/08/getting-timing-of-trait-changes-from.html</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extracts raw transition times from a simmap (collapses multiple transitions</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># down into single transition events)</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get tips and their states</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> phytools<span class="sc">::</span><span class="fu">getStates</span>(simmap,<span class="st">"tips"</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get unique states</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(x))</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get length of states</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">length</span>(states)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># below makes a little matrix describing transitions</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  ct <span class="ot">&lt;-</span> <span class="fu">sapply</span>(states, </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>               <span class="cf">function</span>(x,y) <span class="fu">sapply</span>(y, <span class="cf">function</span>(y,x) <span class="fu">paste</span>(x,<span class="st">"-&gt;"</span>, y, <span class="at">sep=</span><span class="st">""</span>), </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">x =</span> x), <span class="at">y =</span> states)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(x, states)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then a matrix to invalidate self-&gt;self transitions</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  ii <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">TRUE</span>, m, m)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diag</span>(ii) <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, m)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then a list to store results in</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  changes <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"list"</span>, <span class="at">length =</span> m<span class="sc">*</span>(m <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(m)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># named by types of transitions</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(changes) <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(ct[ii])</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(ct, ii)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then singling out maps where transitions happen (where there is more than 1 state)</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> <span class="fu">sapply</span>(simmap<span class="sc">$</span>maps, length) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">which</span>(nc <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> nc[ind]</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># getting the node heights (measure of time/branch lengths) across the tree</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> phytools<span class="sc">::</span><span class="fu">nodeHeights</span>(simmap)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  maps <span class="ot">&lt;-</span> simmap<span class="sc">$</span>maps[ind]</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then looping through and calculating the node heights of each transition</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(maps)){</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nc[i]){</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>      sc <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">names</span>(maps[[i]])[j<span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">1</span>)], <span class="at">collapse =</span> <span class="st">"-&gt;"</span>)</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>      h <span class="ot">&lt;-</span> H[ind[i], <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">cumsum</span>(maps[[i]])[j]</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>      changes[[sc]] <span class="ot">&lt;-</span> <span class="fu">c</span>(changes[[sc]], <span class="fu">as.numeric</span>(h))</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(nc, ind, h, H, i, j, sc, maps)</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># removing any nulls from list of changes and sorting small to large</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>  changes <span class="ot">&lt;-</span> changes[<span class="sc">!</span><span class="fu">sapply</span>(changes, is.null)]</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>  changes <span class="ot">&lt;-</span> <span class="fu">lapply</span>(changes, sort, <span class="at">decreasing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now convert this changes list into nice data frame output</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(changes)){</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(changes[i])</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">transition =</span> <span class="fu">colnames</span>(df)) <span class="sc">%&gt;%</span></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">nodeheight =</span> <span class="dv">1</span>)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>    output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(output, df)</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># node heights are the height above the root, so time but inverse along the tree</span></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to get time from node heights need to subtract from max height of tree</span></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nodeHeights</span>(simmap)) <span class="sc">-</span> output<span class="sc">$</span>nodeheight</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get rid of nodeheight column</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> output[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and return the output! to graph etc.</span></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>  output</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a><span class="co"># End of function ====================================================================================== #</span></span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref[0] -&gt; Ref[3]</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a>mtrees <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../output/RDS/mtrees_multiSimmap.rds"</span>)</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="co"># apply function across list of multiple simulations:</span></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a>armature_transitions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mtrees)){</span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(i, <span class="fu">transition_times</span>(mtrees[[i]]))</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a>  armature_transitions <span class="ot">&lt;-</span> <span class="fu">rbind</span>(armature_transitions, temp)</span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp, i)</span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(armature_transitions<span class="sc">$</span>transition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
armature-&gt;no_armature no_armature-&gt;armature 
                 9042                  5344 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build new data frame with cumulative number of transitions</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>armature_trans_cumul <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  trans <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(i <span class="sc">==</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">trans_no =</span> <span class="fu">row_number</span>(i))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  armature_trans_cumul <span class="ot">&lt;-</span> <span class="fu">rbind</span>(armature_trans_cumul, trans)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(n, trans)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="do">##### copied from somewhere else in the code from the same script....:</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co"># first need to know average number of transitions, rounded</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>trans_avg_length <span class="ot">&lt;-</span> armature_trans_cumul <span class="sc">%&gt;%</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition, i) <span class="sc">%&gt;%</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_trans =</span> <span class="fu">max</span>(trans_no)) <span class="sc">%&gt;%</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">==</span> no_trans) <span class="sc">%&gt;%</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition) <span class="sc">%&gt;%</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_length =</span> <span class="fu">round</span>(<span class="fu">mean</span>(no_trans), <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(transition, avg_length) <span class="sc">%&gt;%</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="co"># now knowing this, can rearrange data and average times across rows</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>avg_trans_times <span class="ot">&lt;-</span> armature_trans_cumul <span class="sc">%&gt;%</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition, trans_no) <span class="sc">%&gt;%</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_time =</span> <span class="fu">mean</span>(time)) <span class="sc">%&gt;%</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">SE_time =</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(time) <span class="sc">/</span> <span class="fu">length</span>(time))) <span class="sc">%&gt;%</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(transition, trans_no, avg_time, SE_time) <span class="sc">%&gt;%</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce avg_trans_times to trans_avg_length</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>avg_trans_times_a2na <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">1</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using one column matrices in `filter()` was deprecated in dplyr 1.1.0.
ℹ Please use one dimensional logical vectors instead.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>avg_trans_times_na2a <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>avg_trans_times <span class="ot">&lt;-</span> <span class="fu">rbind</span>(avg_trans_times_a2na, avg_trans_times_na2a)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(avg_trans_times_a2na, avg_trans_times_na2a)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># export these results to csv in case I need them</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(avg_trans_times, <span class="st">"../Fig4Pollination/mean_transition_times_armature_MCC.csv"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="do">#### Plotting ======================================</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("prettyGraphs") #to set transparancy of colors with "alpha"</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prettyGraphs)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>myColours <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"#FFBB00"</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>myColoursAlpha <span class="ot">&lt;-</span> <span class="fu">add.alpha</span>(myColours, <span class="at">alpha=</span><span class="fl">0.4</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> <span class="fu">setNames</span>(myColoursAlpha, <span class="fu">c</span>(<span class="st">"armature-&gt;no_armature"</span>, <span class="st">"no_armature-&gt;armature"</span>))</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"../Fig4Pollination/armature_transition_times_mean_hist.pdf"</span>, <span class="at">height =</span> <span class="fl">2.8</span>, <span class="at">width =</span> <span class="dv">6</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>min <span class="ot">&lt;-</span> <span class="fu">min</span>(avg_trans_times<span class="sc">$</span>avg_time)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>max <span class="ot">&lt;-</span> <span class="fu">max</span>(avg_trans_times<span class="sc">$</span>avg_time)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>ax <span class="ot">&lt;-</span> <span class="fu">pretty</span>(min<span class="sc">:</span><span class="dv">35</span>, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">arm_to_no_arm =</span> avg_time) <span class="sc">%&gt;%</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(arm_to_no_arm)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_arm_to_arm =</span> avg_time) <span class="sc">%&gt;%</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(no_arm_to_arm)</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>a2na <span class="ot">&lt;-</span> <span class="fu">hist</span>(arm_to_no_arm<span class="sc">$</span>arm_to_no_arm, <span class="at">breaks =</span> ax, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>na2a <span class="ot">&lt;-</span> <span class="fu">hist</span>(no_arm_to_arm<span class="sc">$</span>no_arm_to_arm, <span class="at">breaks =</span> ax, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (a2na, <span class="at">col =</span> myColours[<span class="dv">1</span>], <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>,  </span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"number of transitions"</span>, </span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">0</span>)) <span class="co"># alter if x values change!</span></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (na2a, <span class="at">col =</span> my_cols[<span class="dv">2</span>], <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="co"># data for density graph</span></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">arm_to_no_arm =</span> time) <span class="sc">%&gt;%</span></span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(arm_to_no_arm, <span class="at">simulation =</span> i)</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_arm_to_arm =</span> time) <span class="sc">%&gt;%</span></span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(no_arm_to_arm, <span class="at">simulation =</span> i)</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density curve</span></span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>density_a2na <span class="ot">&lt;-</span> <span class="fu">density</span>(arm_to_no_arm<span class="sc">$</span>arm_to_no_arm)</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>density_na2a <span class="ot">&lt;-</span> <span class="fu">density</span>(no_arm_to_arm<span class="sc">$</span>no_arm_to_arm)</span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the density</span></span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(density_a2na, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> myColours[<span class="dv">1</span>], </span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">58</span>,<span class="dv">0</span>), <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.4</span>, <span class="at">cex.axis =</span> <span class="fl">1.4</span>, <span class="at">main =</span> <span class="cn">NULL</span>, <span class="at">sub =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>)</span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(density_na2a, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> myColours[<span class="dv">2</span>], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">58</span>,<span class="dv">0</span>))</span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a><span class="co"># add data-points with noise in the X-axis</span></span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a><span class="fu">rug</span>(<span class="fu">jitter</span>(no_arm_to_arm<span class="sc">$</span>no_arm_to_arm), <span class="at">col =</span> my_cols[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rug(jitter(no_arm_to_arm$no_arm_to_arm), col = my_cols[1]): some
values will be clipped</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rug</span>(<span class="fu">jitter</span>(arm_to_no_arm<span class="sc">$</span>arm_to_no_arm), <span class="at">col =</span> my_cols[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rug(jitter(arm_to_no_arm$arm_to_no_arm), col = my_cols[2]): some
values will be clipped</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"../output/Figs/RatesPlot.pdf"</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))    <span class="co"># increase margins</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> changes_table <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># first set up basic plot parameters</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arm_to_no_arm<span class="sc">$</span>trans_no <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">60</span>),</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_cols[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">15</span>,</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>, </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"number of transitions"</span>,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.8</span>, <span class="at">cex.axis =</span> <span class="fl">1.8</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># then loop through all data and add all points and lines to plot for 1000 simulations</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(i <span class="sc">==</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition) <span class="sc">%&gt;%</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">trans_no =</span> <span class="fu">row_number</span>(i))</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  no_arm_to_arm <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>)</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>  arm_to_no_arm <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>)</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(arm_to_no_arm<span class="sc">$</span>trans_no <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time, </span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_cols[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">15</span>)</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(arm_to_no_arm<span class="sc">$</span>trans_no <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time, </span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> my_cols[<span class="dv">1</span>])</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(no_arm_to_arm<span class="sc">$</span>trans_no <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>time, </span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_cols[<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(no_arm_to_arm<span class="sc">$</span>trans_no <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>time, </span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span>my_cols[<span class="dv">2</span>])</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="co"># then add average points and line in blue</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="co"># first prep data</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a><span class="co"># then add to plot</span></span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(arm_to_no_arm<span class="sc">$</span>trans_no <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>avg_time,</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">15</span>)</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(arm_to_no_arm<span class="sc">$</span>trans_no <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>avg_time, </span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(no_arm_to_arm<span class="sc">$</span>trans_no <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>avg_time,</span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(no_arm_to_arm<span class="sc">$</span>trans_no <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>avg_time, </span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"armature-&gt;no_armature"</span>, <span class="st">"no_armature-&gt;armature"</span>),</span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(my_cols[<span class="dv">1</span>],my_cols[<span class="dv">2</span>]),</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">17</span>), <span class="at">pt.lwd =</span> <span class="fl">0.001</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">1.8</span>)</span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
</section>
<section id="my-adaptation-of-pollination-study" class="level1">
<h1>My adaptation of pollination study</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">## below adapted from other script:  https://github.com/rubysaltbush/pollination-macroevolution/blob/main/scripts/analysis/simmap.R</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>armature_transitions <span class="ot">&lt;-</span> rates_df</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># build new data frame with cumulative number of transitions</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>armature_trans_cumul <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  trans <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(N_sim <span class="sc">==</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition) <span class="sc">%&gt;%</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">trans_no =</span> <span class="fu">row_number</span>(N_sim))</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  armature_trans_cumul <span class="ot">&lt;-</span> <span class="fu">rbind</span>(armature_trans_cumul, trans)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(n, trans)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================================================================== #</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  Now we are summarizing over the 100 simulations:</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================================================================== #</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="do">##### copied from somewhere else in the code from the same script....:</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="co"># first need to know average number of transitions and across simulations, rounded. </span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>trans_avg_length <span class="ot">&lt;-</span> armature_trans_cumul <span class="sc">%&gt;%</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition, N_sim) <span class="sc">%&gt;%</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_trans =</span> <span class="fu">max</span>(trans_no)) <span class="sc">%&gt;%</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">==</span> no_trans) <span class="sc">%&gt;%</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition) <span class="sc">%&gt;%</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_length =</span> <span class="fu">round</span>(<span class="fu">mean</span>(no_trans), <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(transition, avg_length) <span class="sc">%&gt;%</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="co"># now knowing this, can rearrange data and average times and edge.lengths across rows</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>avg_trans_times <span class="ot">&lt;-</span> armature_trans_cumul <span class="sc">%&gt;%</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(transition, trans_no) <span class="sc">%&gt;%</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_time =</span> <span class="fu">mean</span>(time)) <span class="sc">%&gt;%</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">SE_time =</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(time) <span class="sc">/</span> <span class="fu">length</span>(time)),</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">avg_edge.length =</span> <span class="fu">mean</span>(edge.length)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(N_sim, segsID, transition) <span class="sc">%&gt;%</span></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_Nchanges =</span> <span class="fu">mean</span>(Nchanges)) <span class="sc">%&gt;%</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(transition, trans_no, avg_time, SE_time, avg_edge.length, avg_Nchanges) <span class="sc">%&gt;%</span></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `N_sim`, `segsID`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce avg_trans_times to trans_avg_length</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>avg_trans_times_a2na <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>avg_trans_times_na2a <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>avg_trans_times <span class="ot">&lt;-</span> <span class="fu">rbind</span>(avg_trans_times_a2na, avg_trans_times_na2a)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(avg_trans_times_a2na, avg_trans_times_na2a)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># export these results to csv in case I need them</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(avg_trans_times, <span class="st">"../output/CSV/mean_transition_times_armature_MCC.csv"</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="do">#### Plotting ======================================</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("prettyGraphs") #to set transparancy of colors with "alpha"</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prettyGraphs)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>myColours <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"#FFBB00"</span>)</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>myColoursAlpha <span class="ot">&lt;-</span> <span class="fu">add.alpha</span>(myColours, <span class="at">alpha=</span><span class="fl">0.4</span>)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> <span class="fu">setNames</span>(myColoursAlpha, <span class="fu">c</span>(<span class="st">"armature-&gt;no_armature"</span>, <span class="st">"no_armature-&gt;armature"</span>))</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"../output/Figs/armature_transition_times_mean_hist.pdf"</span>, <span class="at">height =</span> <span class="fl">2.8</span>, <span class="at">width =</span> <span class="dv">6</span>)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>min <span class="ot">&lt;-</span> <span class="fu">min</span>(avg_trans_times<span class="sc">$</span>avg_time)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>max <span class="ot">&lt;-</span> <span class="fu">max</span>(avg_trans_times<span class="sc">$</span>avg_time)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>ax <span class="ot">&lt;-</span> <span class="fu">pretty</span>(min<span class="sc">:</span><span class="dv">50</span>, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">arm_to_no_arm =</span> avg_time) <span class="sc">%&gt;%</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(arm_to_no_arm)</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_arm_to_arm =</span> avg_time) <span class="sc">%&gt;%</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(no_arm_to_arm)</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>a2na <span class="ot">&lt;-</span> <span class="fu">hist</span>(arm_to_no_arm<span class="sc">$</span>arm_to_no_arm, <span class="at">breaks =</span> ax, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>na2a <span class="ot">&lt;-</span> <span class="fu">hist</span>(no_arm_to_arm<span class="sc">$</span>no_arm_to_arm, <span class="at">breaks =</span> ax, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (a2na, <span class="at">col =</span> myColours[<span class="dv">1</span>], <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>,  </span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"number of transitions"</span>, </span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">0</span>)) <span class="co"># alter if x values change!</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (na2a, <span class="at">col =</span> my_cols[<span class="dv">2</span>], <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a><span class="co"># data for density graph</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">arm_to_no_arm =</span> time,</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">rate_arm_to_no_arm =</span> rate) <span class="sc">%&gt;%</span></span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(arm_to_no_arm, rate_arm_to_no_arm, <span class="at">simulation =</span> N_sim)</span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_arm_to_arm =</span> time,</span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">rate_no_arm_to_arm =</span> rate) <span class="sc">%&gt;%</span></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(no_arm_to_arm, rate_no_arm_to_arm, <span class="at">simulation =</span> N_sim)</span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot density of transitions ==================================================================== #</span></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density curve</span></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a>density_a2na <span class="ot">&lt;-</span> <span class="fu">density</span>(arm_to_no_arm<span class="sc">$</span>arm_to_no_arm)</span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a>density_na2a <span class="ot">&lt;-</span> <span class="fu">density</span>(no_arm_to_arm<span class="sc">$</span>no_arm_to_arm)</span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the density</span></span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(density_a2na, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> myColours[<span class="dv">1</span>], </span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">58</span>,<span class="dv">0</span>), <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.4</span>, <span class="at">cex.axis =</span> <span class="fl">1.4</span>, <span class="at">main =</span> <span class="cn">NULL</span>, <span class="at">sub =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>)</span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(density_na2a, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> myColours[<span class="dv">2</span>], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">58</span>,<span class="dv">0</span>))</span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot density of rate: ========================================================================== #</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # calculate density curve</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># density_a2na_rate &lt;- density(arm_to_no_arm$rate_arm_to_no_arm)</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># density_na2a_rate &lt;- density(no_arm_to_arm$rate_no_arm_to_arm)</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(density_a2na_rate, lwd = 2, col = myColours[1], </span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#      xlim = c(0,0.15), xlab = "Relative Transitions", bty = "l", ylim=c(0, 170),</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">#      cex.lab = 1.4, cex.axis = 1.4, main = NULL, sub = NULL, title = NULL)</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density_na2a_rate, lwd = 2, col = myColours[2], xlim = c(0,0.15))</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # add data-points with noise in the X-axis</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># rug(jitter(no_arm_to_arm$rate_no_arm_to_arm), col = my_cols[1])</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co"># rug(jitter(arm_to_no_arm$rate_arm_to_no_arm), col = my_cols[2])</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="do">##################</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"../output/Figs/RatesPlot.pdf"</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))    <span class="co"># increase margins</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> armature_trans_cumul <span class="sc">%&gt;%</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_arm_to_no_arm =</span> rate)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="co"># first set up basic plot parameters</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arm_to_no_arm<span class="sc">$</span>rate_arm_to_no_arm <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time,</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, </span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_cols[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">15</span>,</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>, </span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Cumulative number of transitions"</span>,</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.8</span>, <span class="at">cex.axis =</span> <span class="fl">1.8</span>)</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="co"># then loop through all data and add all points and lines to plot for 1000 simulations</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>  no_arm_to_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) </span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  arm_to_no_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) </span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(arm_to_no_arm<span class="sc">$</span>rate <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time, </span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_cols[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">15</span>)</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(arm_to_no_arm<span class="sc">$</span>rate <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time, </span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> my_cols[<span class="dv">1</span>])</span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(no_arm_to_arm<span class="sc">$</span>rate <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>time, </span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_cols[<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(no_arm_to_arm<span class="sc">$</span>rate <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>time, </span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span>my_cols[<span class="dv">2</span>])</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a><span class="co"># then add average points and line in blue</span></span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a><span class="co"># first prep data</span></span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a><span class="co"># then add to plot</span></span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(arm_to_no_arm<span class="sc">$</span>trans_no<span class="sc">/</span>arm_to_no_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>avg_time,</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">15</span>)</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(arm_to_no_arm<span class="sc">$</span>trans_no<span class="sc">/</span>arm_to_no_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>avg_time, </span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(no_arm_to_arm<span class="sc">$</span>trans_no<span class="sc">/</span>no_arm_to_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>avg_time,</span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(no_arm_to_arm<span class="sc">$</span>trans_no<span class="sc">/</span>no_arm_to_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>avg_time, </span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"armature-&gt;no_armature"</span>, <span class="st">"no_armature-&gt;armature"</span>),</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(my_cols[<span class="dv">1</span>],my_cols[<span class="dv">2</span>]),</span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">17</span>), <span class="at">pt.lwd =</span> <span class="fl">0.001</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">1.8</span>)</span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<section id="same-thing-in-ggplot2-rates-plot" class="level2">
<h2 class="anchored" data-anchor-id="same-thing-in-ggplot2-rates-plot">same thing in ggplot2 (rates plot)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ctt</span>(object, <span class="at">type=</span><span class="st">"rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Armature -&gt; No Armature:</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">data =</span> arm_to_no_arm, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rate, <span class="at">colour =</span> <span class="st">"Armature -&gt; no Armature"</span>), <span class="at">pch =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> arm_to_no_arm, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rate, <span class="at">colour =</span> <span class="st">"Armature -&gt; no Armature"</span>)) <span class="sc">+</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># No Armature -&gt; Armature:</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">data =</span> no_arm_to_arm, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rate, <span class="at">colour =</span> <span class="st">"No Armature -&gt; Armature"</span>), <span class="at">pch =</span> <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> no_arm_to_arm, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rate, <span class="at">colour =</span> <span class="st">"No Armature -&gt; Armature"</span>)) <span class="sc">+</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> avg_trans_times <span class="sc">%&gt;%</span> <span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>), </span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> avg_time, <span class="at">y =</span> avg_Nchanges <span class="sc">/</span> avg_edge.length, <span class="at">colour =</span> <span class="st">"Armature -&gt; no Armature"</span>), </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">pch =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> avg_trans_times <span class="sc">%&gt;%</span> <span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>),</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> avg_time, <span class="at">y =</span> avg_Nchanges <span class="sc">/</span> avg_edge.length, <span class="at">colour =</span> <span class="st">"Armature -&gt; no Armature"</span>)) <span class="sc">+</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> avg_trans_times <span class="sc">%&gt;%</span> <span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>),</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> avg_time, <span class="at">y =</span> avg_Nchanges <span class="sc">/</span> avg_edge.length, <span class="at">colour =</span> <span class="st">"No Armature -&gt; Armature"</span>), </span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">pch =</span> <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> avg_trans_times <span class="sc">%&gt;%</span> <span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>),</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> avg_time, <span class="at">y =</span> avg_Nchanges <span class="sc">/</span> avg_edge.length, <span class="at">colour =</span> <span class="st">"No Armature -&gt; Armature"</span>)) <span class="sc">+</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set plot aesthetics</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">discrete=</span>T, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span> </span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="dv">45</span>, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Time since the origin of clade (mya)"</span>,</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"relative changes per edge.length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 16 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 16 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="plot-the-rate-2" class="level1">
<h1>Plot the rate 2</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>rates_df <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(N_sim, transition) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> segs_end , <span class="at">y =</span> rate, <span class="at">group =</span> <span class="fu">as.factor</span>(transition), <span class="at">col =</span> <span class="fu">as.factor</span>(transition))) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete=</span>T, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 15 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 15 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plots from pollination study:</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> rates_df <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">arm_to_no_arm =</span> avg_time) <span class="sc">%&gt;%</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(arm_to_no_arm)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">no_arm_to_arm =</span> avg_time) <span class="sc">%&gt;%</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(no_arm_to_arm)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density curve</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>density_a2na <span class="ot">&lt;-</span> <span class="fu">density</span>(arm_to_no_arm<span class="sc">$</span>arm_to_no_arm)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>density_na2a <span class="ot">&lt;-</span> <span class="fu">density</span>(no_arm_to_arm<span class="sc">$</span>no_arm_to_arm)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the density</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(density_a2na, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> myColours[<span class="dv">1</span>], </span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">58</span>,<span class="dv">0</span>), <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.4</span>, <span class="at">cex.axis =</span> <span class="fl">1.4</span>, <span class="at">main =</span> <span class="cn">NULL</span>, <span class="at">sub =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(density_na2a, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> myColours[<span class="dv">2</span>], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">58</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="another-try-of-rates-plot" class="level1">
<h1>Another try of rates plot</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rates Plot in ggplot2</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># several layers:</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. cumulative rates (?) grouped by transitions</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. each rate from each simulation grouped by transition</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"../output/Figs/RatesPlot.pdf"</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))    <span class="co"># increase margins</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> armature_trans_cumul <span class="sc">%&gt;%</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_arm_to_no_arm =</span> rate)</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(armature_trans_cumul, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rate, <span class="at">group =</span> transition, <span class="at">color =</span> transition)) <span class="sc">+</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> transition), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Add points</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add connecting lines</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>() <span class="sc">+</span>  <span class="co"># Reverse the x-axis</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span>  <span class="co"># Set y-axis limits</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of transitions (mya)"</span>,</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative number of transitions"</span>,</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Transition"</span>,</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"Transition"</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values (`geom_point()`).</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first set up basic plot parameters</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arm_to_no_arm<span class="sc">$</span>rate <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_cols[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">15</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time of transitions (mya)"</span>, </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Cumulative number of transitions"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.8</span>, <span class="at">cex.axis =</span> <span class="fl">1.8</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co"># then loop through all data and add all points and lines to plot for 1000 simulations</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  no_arm_to_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  arm_to_no_arm <span class="ot">&lt;-</span> armature_transitions <span class="sc">%&gt;%</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) </span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(arm_to_no_arm<span class="sc">$</span>rate <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time, </span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_cols[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">15</span>)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(arm_to_no_arm<span class="sc">$</span>rate <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>time, </span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> my_cols[<span class="dv">1</span>])</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(no_arm_to_arm<span class="sc">$</span>rate <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>time, </span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_cols[<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(no_arm_to_arm<span class="sc">$</span>rate <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>time, </span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span>my_cols[<span class="dv">2</span>])</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co"># then add average points and line in blue</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co"># first prep data</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>no_arm_to_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"no_armature-&gt;armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>arm_to_no_arm <span class="ot">&lt;-</span> avg_trans_times <span class="sc">%&gt;%</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transition <span class="sc">==</span> <span class="st">"armature-&gt;no_armature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trans_no <span class="sc">&lt;=</span> trans_avg_length[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="co"># then add to plot</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(arm_to_no_arm<span class="sc">$</span>trans_no<span class="sc">/</span>arm_to_no_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>avg_time,</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">15</span>)</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(arm_to_no_arm<span class="sc">$</span>trans_no<span class="sc">/</span>arm_to_no_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> arm_to_no_arm<span class="sc">$</span>avg_time, </span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(no_arm_to_arm<span class="sc">$</span>trans_no<span class="sc">/</span>no_arm_to_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>avg_time,</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(no_arm_to_arm<span class="sc">$</span>trans_no<span class="sc">/</span>no_arm_to_arm<span class="sc">$</span>avg_edge.length <span class="sc">~</span> no_arm_to_arm<span class="sc">$</span>avg_time, </span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"armature-&gt;no_armature"</span>, <span class="st">"no_armature-&gt;armature"</span>),</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(my_cols[<span class="dv">1</span>],my_cols[<span class="dv">2</span>]),</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">17</span>), <span class="at">pt.lwd =</span> <span class="fl">0.001</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">1.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot.multictt-function" class="level1">
<h1>-- Plot.multiCtt function –</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plot.multiCtt<span class="ot">&lt;-</span><span class="cf">function</span>(x,...){</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">hasArg</span>(alpha)) alpha<span class="ot">&lt;-</span><span class="fu">list</span>(...)<span class="sc">$</span>alpha</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> alpha<span class="ot">&lt;-</span><span class="fl">0.05</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  segments<span class="ot">&lt;-</span>x[[<span class="dv">1</span>]]<span class="sc">$</span>segments</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  nchanges<span class="ot">&lt;-</span><span class="fu">sapply</span>(x,<span class="cf">function</span>(x) x<span class="sc">$</span>nchanges)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">hasArg</span>(type)) type<span class="ot">&lt;-</span><span class="fu">list</span>(...)<span class="sc">$</span>type</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> type<span class="ot">&lt;-</span><span class="st">"rate"</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  edge.length<span class="ot">&lt;-</span><span class="fu">sapply</span>(x,<span class="cf">function</span>(x) x<span class="sc">$</span>edge.length)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  obj<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">segments=</span>segments,<span class="at">nchanges=</span><span class="fu">rowMeans</span>(nchanges),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">edge.length=</span><span class="fu">rowMeans</span>(edge.length),<span class="at">tree=</span>x[[<span class="dv">1</span>]]<span class="sc">$</span>tree)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(obj)<span class="ot">&lt;-</span><span class="st">"ctt"</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  lower<span class="ot">&lt;-</span><span class="fu">max</span>(<span class="fu">floor</span>(alpha<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(x)),<span class="dv">1</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  upper<span class="ot">&lt;-</span><span class="fu">min</span>(<span class="fu">ceiling</span>((<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">length</span>(x)),<span class="fu">ncol</span>(nchanges))</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  xx<span class="ot">&lt;-</span><span class="fu">max</span>(<span class="fu">nodeHeights</span>(x[[<span class="dv">1</span>]]<span class="sc">$</span>tree))<span class="sc">-</span><span class="fu">as.vector</span>(<span class="fu">t</span>(segments))</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  xx<span class="ot">&lt;-</span><span class="fu">c</span>(xx,xx[<span class="fu">length</span>(xx)<span class="sc">:</span><span class="dv">1</span>])</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  y.lower<span class="ot">&lt;-</span><span class="cf">if</span>(type<span class="sc">==</span><span class="st">"number"</span>) <span class="fu">apply</span>(nchanges,<span class="dv">1</span>,sort)[lower,] <span class="cf">else</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type<span class="sc">==</span><span class="st">"rate"</span>) <span class="fu">apply</span>(nchanges<span class="sc">/</span>edge.length,<span class="dv">1</span>,sort)[lower,]</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  y.upper<span class="ot">&lt;-</span><span class="cf">if</span>(type<span class="sc">==</span><span class="st">"number"</span>) <span class="fu">apply</span>(nchanges,<span class="dv">1</span>,sort)[upper,] <span class="cf">else</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type<span class="sc">==</span><span class="st">"rate"</span>) <span class="fu">apply</span>(nchanges<span class="sc">/</span>edge.length,<span class="dv">1</span>,sort)[upper,]</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  y.lower<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">rbind</span>(y.lower,y.lower))</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  y.upper<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">rbind</span>(y.upper,y.upper))</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  yy<span class="ot">&lt;-</span><span class="fu">c</span>(y.lower,y.upper[<span class="fu">length</span>(y.upper)<span class="sc">:</span><span class="dv">1</span>])</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  args<span class="ot">&lt;-</span><span class="fu">list</span>(...)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(args<span class="sc">$</span>alpha)) args<span class="sc">$</span>alpha<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>col)) args<span class="sc">$</span>col<span class="ot">&lt;-</span><span class="st">"blue"</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(args<span class="sc">$</span>ylim)) args<span class="sc">$</span>ylim<span class="ot">&lt;-</span><span class="fu">range</span>(yy)</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>x<span class="ot">&lt;-</span>obj</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(plot,args)</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(xx,yy,<span class="at">col=</span><span class="fu">make.transparent</span>(<span class="st">"grey"</span>,<span class="fl">0.4</span>),<span class="at">border=</span><span class="dv">0</span>)</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.multiCtt</span>(object_list, <span class="at">type=</span><span class="st">"rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Quarto_CTT_New_files/figure-html/plot.multiCtt()-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>